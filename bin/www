// #!/usr/bin/env node
const express = require('express');
const path = require('path');

const app = express();
const PORT = process.env('PORT') || 3001;
app.set('trust proxy', true)
app.use(express.json()); // to parse JSON bodies

// Serve static files (React build)
app.use('/api/uploads', express.static(path.join(__dirname, '../public/uploads')));

console.log('Uploads directory is... ', path.join(__dirname, '../public/uploads'));

// Add this middleware to log requests
app.use('/api/uploads', (req, res, next) => {
    console.log('Upload request:', req.path);
    next();
});

// Example API route
app.get('/api/hello', (req, res) => {
  res.json({ message: 'Hello from Flex API!' });
});

// Mount the routers at /api/...
const applicationRouter = require('../routes/application');
app.use('/api/application', applicationRouter);
const categoriesRouter = require('../routes/categories');
app.use('/api/categories', categoriesRouter);
const clientsRouter = require('../routes/clients');
app.use('/api/clients', clientsRouter);
const employeesRouter = require('../routes/employees');
app.use('/api/employees', employeesRouter);
const hiringsRouter = require('../routes/hirings');
app.use('/api/hirings', hiringsRouter);
const indexRouter = require('../routes/index');
app.use('/api/index', indexRouter);
const officeLocationsRouter = require('../routes/officeLocations');
app.use('/api/officeLocations', officeLocationsRouter);
const projectAllocationsRouter = require('../routes/projectAllocations');
app.use('/api/projectAllocations', projectAllocationsRouter);
const projectsRouter = require('../routes/projects');
app.use('/api/projects', projectsRouter);
const projectUtilizationsRouter = require('../routes/projectAllocations');
app.use('/api/projectAllocations', projectUtilizationsRouter);
const reportsRouter = require('../routes/reports');
app.use('/api/reports', reportsRouter);
const timesheetsRouter = require('../routes/timesheets');
app.use('/api/timesheets', timesheetsRouter);
const usersRouter = require('../routes/users');
app.use('/api/users', usersRouter);

app.listen(PORT, () => {
  console.log(`Server running on http://localhost:${PORT}`);
});
